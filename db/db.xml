<?xml version="1.0" encoding="utf-8"?>
<posts>
 <row Id="148762" PostTypeId="1" CreationDate="2016-09-03T19:38:06.453" Score="-5" ViewCount="17" Body="&lt;p&gt;I have employee data&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Where an employee hiring for a 'jobcode'. In a month 3 different employee joint for few days only. I want to calculate that how many days that job code is vacant.&lt;/p&gt;&#xA;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;&lt;p&gt;an employee join on 05/08/2016 and worked upto 12/08/2016 so here this jobcode was vacant for 4 days.&lt;/p&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;p&gt;next employee join for sam jobcode on 15/08/2016 and stop working on 20/08/2016 so here jobcode was vacant from 12/08/2016 to 15/08/2016 for 2 days like this I want to calculate &lt;/p&gt;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&#xA;&lt;pre class=&quot;lang-none prettyprint-override&quot;&gt;&lt;code&gt;NO  JOBCODE     FROMDATE    TODATE      VACANT DAY&#xA;1   01/02/ME-01 05/07/2016  12/07/2016  4 DAYS&#xA;2   01/02/ME-01 15/07/2016  20/07/2016  2 DAYS&#xA;3   01/02/ME-01 25/07/2016              4 DAYS&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;" OwnerUserId="105034" LastEditorUserId="1822" LastEditDate="2016-09-03T20:08:10.097" LastActivityDate="2016-09-03T20:08:10.097" Title="Need to extract days of vacancy in SQL" Tags="&lt;sql&gt;" AnswerCount="0" CommentCount="2" />
  <row Id="148763" PostTypeId="2" ParentId="68850" CreationDate="2016-09-03T20:57:49.377" Score="1" Body="&lt;p&gt;Unless the users is mapped to the sysadmin fixed server role (where they will connect to the database as the user dbo) then they can be limited by security on the database.  (i.e. A member of db_owner will receive a security check where dbo will not.)&lt;/p&gt;&#xA;&#xA;&lt;p&gt;A quick test to see if it is a permissions issue is to temporarily grant a user sysadmin role and then see if they can delete data....  if not then I'd start looking for constraints on tables. &lt;/p&gt;&#xA;&#xA;&lt;p&gt;If they can then run the following against the database (you may get more you may need to add DELETE to your where clause):&lt;/p&gt;&#xA;&#xA;&lt;pre&gt;&lt;code&gt;select * from sys.database_permissions &#xA;where state_desc = 'DENY'&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&lt;p&gt;If permissions are set it will give you something like:&lt;/p&gt;&#xA;&#xA;&lt;pre&gt;&lt;code&gt;class class_desc                                                   major_id    minor_id    grantee_principal_id grantor_principal_id type permission_name                                                                                                                  state state_desc&#xA;----- ------------------------------------------------------------ ----------- ----------- -------------------- -------------------- ---- -------------------------------------------------------------------------------------------------------------------------------- ----- ------------------------------------------------------------&#xA;0     DATABASE                                                     0           0           10                   1                    DL   DELETE                                                                                                                           D     DENY&#xA;1     OBJECT_OR_COLUMN                                             1501607433  0           10                   1                    DL   DELETE                                                                                                                           D     DENY&#xA;&#xA;(2 row(s) affected)&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&lt;p&gt;If deny delete is set at the DATABASE level then well then there is your problem.  Adjust permissions so required users are not actually DENYed access.&lt;/p&gt;&#xA;" OwnerUserId="105036" LastActivityDate="2016-09-03T20:57:49.377" CommentCount="0" />
  <row Id="148764" PostTypeId="1" CreationDate="2016-09-03T22:03:52.013" Score="0" ViewCount="12" Body="&lt;p&gt;MySQL documentation states that:&lt;/p&gt;&#xA;&#xA;&lt;blockquote&gt;&#xA;  &lt;p&gt;Subqueries in the FROM clause cannot be correlated subqueries. They&#xA;  are materialized in whole (evaluated to produce a result set) during&#xA;  query execution, so they cannot be evaluated per row of the outer&#xA;  query.&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&#xA;&lt;p&gt;Okay, fine, I understand why this is. However, what if you want to repeat a specific query on multiple values?&lt;/p&gt;&#xA;&#xA;&lt;pre&gt;&lt;code&gt;SELECT COUNT( returning_visitors.per_ip ) AS count, AVG( returning_visitors.per_ip ) AS num_visits&#xA;FROM (&#xA;    SELECT COUNT( * ) AS per_ip&#xA;    FROM site_hits_unique&#xA;    WHERE site_hits_unique.site_id = ___INPUT___&#xA;    AND site_hits_unique.date &amp;gt;= CURDATE( ) - INTERVAL 30 DAY&#xA;    GROUP BY site_hits_unique.site_id, site_hits_unique.ip&#xA;    HAVING per_ip &amp;gt;1&#xA;) AS returning_visitors&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&lt;p&gt;Let's say I want to retrieve the result of this query on multiple values in the form of a result table, using the values from &lt;code&gt;SELECT id FROM sites&lt;/code&gt;. Is there a way to do this in a single query without using a stored procedure? Something like:&lt;/p&gt;&#xA;&#xA;&lt;pre&gt;&lt;code&gt;SELECT id, COUNT( returning_visitors.per_ip ) as readers, AVG( returning_visitors.per_ip ) as avg_visits_pr&#xA;FROM sites&#xA;SUBQUERY-PER-ROW (&#xA;    SELECT COUNT( * ) AS per_ip&#xA;    FROM site_hits_unique&#xA;    WHERE site_hits_unique.site_id = sites.id&#xA;    AND site_hits_unique.date &amp;gt;= CURDATE( ) - INTERVAL 30 DAY&#xA;    GROUP BY site_hits_unique.site_id, site_hits_unique.ip&#xA;    HAVING per_ip &amp;gt; 1&#xA;) AS returning_visitors&#xA;WHERE sites.id IN (162888, 42705, 11412)&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&lt;p&gt;&lt;code&gt;SUBQUERY-PER-ROW&lt;/code&gt; here is pseudo-code. &lt;code&gt;JOIN&lt;/code&gt; will not work because of the above quoted restriction.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;EDIT:&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Another attempt at pseudo-code using info from &lt;a href=&quot;http://dev.mysql.com/doc/refman/5.7/en/row-subqueries.html&quot; rel=&quot;nofollow&quot;&gt;http://dev.mysql.com/doc/refman/5.7/en/row-subqueries.html&lt;/a&gt;:&lt;/p&gt;&#xA;&#xA;&lt;pre&gt;&lt;code&gt;SELECT id, (&#xA;    SELECT COUNT( per_ip ) AS count, AVG( per_ip ) AS num_visits&#xA;    FROM (&#xA;        SELECT COUNT( * ) AS per_ip&#xA;        FROM site_hits_unique&#xA;        WHERE site_hits_unique.site_id = sites.id&#xA;        AND site_hits_unique.date &amp;gt;= CURDATE( ) - INTERVAL 30 DAY&#xA;        GROUP BY site_hits_unique.site_id, site_hits_unique.ip&#xA;        HAVING per_ip &amp;gt;1&#xA;    ) AS returning_visitors&#xA;) as (readers, avg_visits_pr)&#xA;FROM sites&#xA;WHERE sites.id IN (162888, 42705, 11412)&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&lt;p&gt;(it doesn't work, this isn't actual valid MySQL syntax, just a pseudo-code example)&lt;/p&gt;&#xA;" OwnerUserId="43968" LastEditorUserId="43968" LastEditDate="2016-09-04T00:23:18.170" LastActivityDate="2016-09-04T01:18:20.930" Title="MySQL Correlated Subquery (with multiple columns) per row" Tags="&lt;mysql&gt;&lt;subquery&gt;" AnswerCount="2" CommentCount="2" />
  <row Id="148765" PostTypeId="2" ParentId="148701" CreationDate="2016-09-03T23:38:59.600" Score="0" Body="&lt;p&gt;The solution I realized needed the &lt;code&gt;INNER JOIN&lt;/code&gt; syntax rather than &lt;code&gt;JOIN ON&lt;/code&gt; syntax for Access 2016 as &lt;code&gt;JOIN ON&lt;/code&gt; without a combination of &lt;code&gt;INNER JOIN&lt;/code&gt;, &lt;code&gt;LEFT OUTER JOIN&lt;/code&gt;, &lt;code&gt;RIGHT OUTER JOIN&lt;/code&gt;, etc. does not work with this DBMS (Database Management System). Further, I changed the &lt;code&gt;AND&lt;/code&gt; logical operator to a &lt;code&gt;WHERE&lt;/code&gt; clause as &lt;code&gt;JOIN ON&lt;/code&gt; syntax followed simply by &lt;code&gt;AND&lt;/code&gt; does not run in Access 2016. Furthermore, the &lt;code&gt;GROUP BY&lt;/code&gt; syntax goes beyond the minimum requirements for this query, so I removed it. Therefore, the solution to my question is as follows:&lt;/p&gt;&#xA;&#xA;&lt;pre&gt;&lt;code&gt;SELECT Column1, Column2, Table1.Column3&#xA;&#xA;FROM Table1 &#xA;&#xA;INNER JOIN Table2&#xA;&#xA;ON Table1.Column3 = Table2.Column3&#xA;&#xA;WHERE Column4 = '{NAME}';&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;" OwnerUserId="104991" LastEditorUserId="104991" LastEditDate="2016-09-03T23:45:59.277" LastActivityDate="2016-09-03T23:45:59.277" CommentCount="0" />
  <row Id="148766" PostTypeId="2" ParentId="73145" CreationDate="2016-09-04T00:32:57.567" Score="0" Body="&lt;p&gt;I have same kind of trouble on Excel 2010 + MSSQL 2012&#xA;SELECT xx FROM xx WHERE InvoiceDate=20160801 ==&gt; 30 sec&#xA;SELECT xx FROM xx WHERE InvoiceDate=? ==&gt; Almost 1 hour&#xA;In my case, I can fix it&#xA;SELECT A.xx , B.yy FROM A , B , C ==&gt; 1 hour&#xA;SELECT A.xx , B.yy FROM A , B ==&gt; 30 sec&#xA;It means I define table C  but NO entry in SELECT&#xA;I removed C from tabel and fix it.&#xA;I hope one of hints&lt;/p&gt;&#xA;" OwnerUserId="105039" LastActivityDate="2016-09-04T00:32:57.567" CommentCount="0" />
  <row Id="148767" PostTypeId="2" ParentId="148288" CreationDate="2016-09-04T00:46:23.317" Score="1" Body="&lt;p&gt;Indeed &lt;strong&gt;the bottleneck was IO&lt;/strong&gt;. Since I was using &lt;code&gt;tar -czf&lt;/code&gt; to compress the files and the CPU was so performant, the drive simply couldn't handle all the data coming so fast (although we use mirrored RAID volumes).&lt;/p&gt;&#xA;&#xA;&lt;p&gt;The &lt;code&gt;mysqldump&lt;/code&gt; itself is no problem at all, but &lt;code&gt;tar&lt;/code&gt; &lt;strong&gt;was slowing down the whole system massively&lt;/strong&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;I'm now using &lt;code&gt;pv&lt;/code&gt; to shape the pipe stream:&lt;/p&gt;&#xA;&#xA;&lt;pre&gt;&lt;code&gt;tar -czf - ./ | pv -q -L 10m &amp;gt; output.tgz&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;-q&lt;/strong&gt; disables output of &lt;code&gt;pv&lt;/code&gt;.&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;-L 10m&lt;/strong&gt; limits the write operation to 10 MB per second. Just test which value you should use on your server by watching the &lt;code&gt;gzip&lt;/code&gt; process via &lt;code&gt;top&lt;/code&gt;. I wanted it to have around 50% CPU usage, so the IO impact is lowered to 50% as well.&lt;/li&gt;&#xA;&lt;li&gt;CPU impact is lowered implicitly, because &lt;code&gt;pv&lt;/code&gt; slows down everything (except of the dump itself, it is done before compression).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;&lt;em&gt;Many thanks to @Michael - sqlbot and others for pushing me into the right direction.&lt;/em&gt; &lt;/p&gt;&#xA;" OwnerUserId="104536" LastEditorUserId="104536" LastEditDate="2016-09-04T00:52:57.160" LastActivityDate="2016-09-04T00:52:57.160" CommentCount="0" />
  <row Id="148768" PostTypeId="2" ParentId="148764" CreationDate="2016-09-04T00:52:16.187" Score="0" Body="&lt;p&gt;Is this what you are looking for?&lt;/p&gt;&#xA;&#xA;&lt;pre&gt;&lt;code&gt;SELECT  s.id,&#xA;        COUNT( rv.per_ip ) as readers,&#xA;        AVG( rv.per_ip ) as avg_visits_pr&#xA;    FROM  sites AS s&#xA;    JOIN  &#xA;    (&#xA;        SELECT  u.site_id,&#xA;                COUNT( * ) AS per_ip&#xA;            FROM  site_hits_unique AS u&#xA;            WHERE  u.date &amp;gt;= CURDATE( ) - INTERVAL 30 DAY&#xA;            GROUP BY  u.site_id, u.ip&#xA;            HAVING  per_ip &amp;gt; 1 &#xA;    )  AS rv ON rv.site_id = s.id&#xA;    WHERE  s.id IN (162888, 42705, 11412)&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&lt;p&gt;Indexes:&lt;/p&gt;&#xA;&#xA;&lt;pre&gt;&lt;code&gt;site_hits_unique: INDEX(site_id, date, ip)&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&lt;p&gt;Or maybe this:&lt;/p&gt;&#xA;&#xA;&lt;pre&gt;&lt;code&gt;SELECT  site_id,&#xA;        COUNT(DISTINCT ip) as readers,&#xA;        COUNT(*) / COUNT(DISTINCT ip) as avg_visits_pr&#xA;    FROM  &#xA;    (&#xA;        SELECT  site_id, ip, COUNT(*) AS per_ip&#xA;            FROM  site_hits_unique&#xA;            WHERE  date &amp;gt;= CURDATE( ) - INTERVAL 30 DAY&#xA;              AND  site_id IN (162888, 42705, 11412)&#xA;            GROUP BY  site_id, ip&#xA;            HAVING  per_ip &amp;gt; 1 &#xA;    ) AS rv&#xA;    GROUP BY  site_id;&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;" OwnerUserId="1876" LastActivityDate="2016-09-04T00:52:16.187" CommentCount="1" />
  <row Id="148769" PostTypeId="1" CreationDate="2016-09-04T00:54:07.987" Score="0" ViewCount="7" Body="&lt;p&gt;I upgraded my RDS postgres instances from 9.3 -&gt; 9.4 -&gt; 9.5 several months ago.  When installing the pganalyzer-collector tool, I got a funny error that the &quot;queryid&quot; column does not exist in the pg_stat_statements table. It looks like that column was added in version 9.4. I'm now running 9.5 and expect to see this column in that table.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;How could this have happened?  And how can I make this column appear in the pg_stat_statements table?&lt;/p&gt;&#xA;" OwnerUserId="105040" LastActivityDate="2016-09-04T02:03:00.100" Title="RDS Postgres - pg_stat_statements is missing queryid column" Tags="&lt;postgresql&gt;&lt;amazonrds&gt;" AnswerCount="1" CommentCount="0" />
  <row Id="148770" PostTypeId="2" ParentId="148764" CreationDate="2016-09-04T01:18:20.930" Score="0" Body="&lt;p&gt;So, I discovered a way to accomplish what I wanted to accomplish using stored procedures. I'm hoping this isn't the only solution and that there is a way to do this with a single query, but here's what I've got.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Stored procedure to get returning readers on a single site_id:&lt;/p&gt;&#xA;&#xA;&lt;pre&gt;&lt;code&gt;DELIMITER $$&#xA;&#xA;CREATE PROCEDURE get_site_readers(&#xA;    IN input_site_id INT,&#xA;    OUT readers INT,&#xA;    OUT avg_visits_pr DOUBLE)&#xA;BEGIN&#xA;&#xA;    SELECT COUNT( per_ip ), AVG( per_ip )&#xA;    INTO readers, avg_visits_pr&#xA;    FROM (&#xA;        SELECT COUNT( * ) AS per_ip&#xA;        FROM site_hits_unique&#xA;        WHERE site_id = input_site_id&#xA;        AND date &amp;gt;= CURDATE( ) - INTERVAL 30 DAY&#xA;        GROUP BY site_id, ip&#xA;        HAVING per_ip &amp;gt; 1&#xA;    ) AS returning_visitors;&#xA;&#xA;END&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&lt;p&gt;Stored procedure to run get_site_readers(...) on every sites.id:&lt;/p&gt;&#xA;&#xA;&lt;pre&gt;&lt;code&gt;DELIMITER $$&#xA;&#xA;CREATE PROCEDURE update_site_readers() BEGIN&#xA;    DECLARE done BOOLEAN DEFAULT FALSE;&#xA;    DECLARE _id BIGINT UNSIGNED;&#xA;    DECLARE cur CURSOR FOR SELECT id FROM sites;&#xA;    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done := TRUE;&#xA;&#xA;    OPEN cur;&#xA;&#xA;    eachSite: LOOP&#xA;        FETCH cur INTO _id;&#xA;        IF done THEN&#xA;            LEAVE eachSite;&#xA;        END IF;&#xA;        CALL get_site_readers(_id, @readers, @avg_visits_pr);&#xA;        UPDATE sites SET readers = @readers, avg_visits_pr = @avg_visits_pr WHERE id=_id;&#xA;    END LOOP eachSite;&#xA;&#xA;    CLOSE cur;&#xA;END&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&lt;p&gt;Notice the query &lt;code&gt;UPDATE sites SET readers = @readers, avg_visits_pr = @avg_visits_pr WHERE id=_id;&lt;/code&gt; - this was my intention from the beginning, to update the sites table with the aggregated data. However, this does not exactly solve the question as defined since originally I was asking about doing a &lt;code&gt;SELECT&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Finally, to call the stored procedure:&lt;/p&gt;&#xA;&#xA;&lt;pre&gt;&lt;code&gt;CALL update_site_readers();&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;" OwnerUserId="43968" LastActivityDate="2016-09-04T01:18:20.930" CommentCount="0" />
  <row Id="148771" PostTypeId="2" ParentId="148769" CreationDate="2016-09-04T02:03:00.100" Score="0" Body="&lt;p&gt;Update:  Lukas from pganalyze helped me.  How nice!&#xA;The answer was as follows:&lt;/p&gt;&#xA;&#xA;&lt;pre&gt;&lt;code&gt;DROP FUNCTION pganalyze.get_stat_statements();&#xA;ALTER EXTENSION pg_stat_statements UPDATE;&#xA;CREATE OR REPLACE FUNCTION pganalyze.get_stat_statements() RETURNS SETOF pg_stat_statements AS&#xA;$$&#xA;/* pganalyze-collector */ SELECT * FROM public.pg_stat_statements;&#xA;$$ LANGUAGE sql VOLATILE SECURITY DEFINER;&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;" OwnerUserId="105040" LastActivityDate="2016-09-04T02:03:00.100" CommentCount="0" />
  <row Id="148772" PostTypeId="1" CreationDate="2016-09-04T03:43:40.417" Score="0" ViewCount="1" Body="&lt;p&gt;I have six SQL Server 2014 servers.  I am not using TDE, Transparent Data Encryption, on any server.  &lt;/p&gt;&#xA;&#xA;&lt;p&gt;I would like to be able to take an &lt;strong&gt;encrypted&lt;/strong&gt; backup of a database on &lt;strong&gt;ANY&lt;/strong&gt; server and restore that backup to &lt;strong&gt;ANY OTHER&lt;/strong&gt; server.  &lt;/p&gt;&#xA;&#xA;&lt;p&gt;What actions do I need to take on each server with the service master key, master database key,  and certificate? I would like to use the minimum number of keys, certificates, and backup files for these keys and certificates.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;What actions do I need to take if I add an additional SQL Server 2014 to the group?&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Thank you all.  Server Fault and Stack Overflow have helped me many times in the past.&lt;/p&gt;&#xA;" OwnerUserId="105042" LastActivityDate="2016-09-04T03:43:40.417" Title="Sharing keys and certificates between SQL Server 2014 server for encrypted backup and restoration" Tags="&lt;backup&gt;&lt;sql-server-2014&gt;&lt;encryption&gt;" AnswerCount="0" CommentCount="0" />
</posts>